generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                       String  @id @default(uuid())
  userId                   String
  type                     String
  provider                 String
  providerAccountId        String
  refresh_token            String?
  access_token             String?
  expires_at               Int?
  token_type               String?
  scope                    String?
  id_token                 String?
  session_state            String?
  refresh_token_expires_in Int?
  user                     User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model User {
  id              String            @id @unique @default(uuid())
  firstname       String?
  lastname        String?
  username        String            @unique
  role            Role              @default(USER)
  createAt        DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  phone           String?           @unique
  avatar          String?
  email           String?           @unique
  accounts        Account[]
  carts           Cart[]            @relation("UserCarts")
  comments        Comment[]
  instructor      Instructor?
  payments        Payment[]         @relation("UserToPayments")
  questions       Question[]
  sessionProgress SessionProgress[] @relation("SessionProgress")
  supportMessages SupportMessage[]
  SupportSession  SupportSession[]
  tickets         Ticket[]
  ticketReplies   TicketReply[]
  courses         UserCourse[]      @relation("UserCourses")
  userDiscount    UserDiscount[]
  terms           UserTerm[]        @relation("UserTerms")
  subscriptions   UserSubscription[]
  shopCarts       ShopCart[]
  shopOrders      ShopOrder[]
  addresses       UserAddress[]
  shopReturnRequests ShopReturnRequest[]
}

model Course {
  id               Int            @id @unique @default(autoincrement())
  title            String
  subtitle         String
  description      String
  cover            String
  isHighPriority   Boolean        @default(false)
  shortAddress     String         @unique
  sessionCount     Int            @default(0)
  level            CourseLevel
  participants     Int            @default(0)
  rating           Float?         @default(5.0)
  status           CourseStatus
  instructorId     Int
  introVideoUrl    String?
  createAt         DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  shortDescription String?
  activeStatus     Boolean        @default(false)
  duration         Int            @default(0)
  price            Int?
  cartCourses      CartCourse[]   @relation("CourseToCartCourses")
  comments         Comment[]
  instructor       Instructor     @relation(fields: [instructorId], references: [id])
  courseTerms      CourseTerm[]   @relation("CourseToTerms")
  discountCodes    DiscountCode[]
  questions        Question[]
  tickets          Ticket[]
  users            UserCourse[]   @relation("UserCourses")
  pricingMode      CoursePricingMode @default(TERM_ONLY)
  subscriptionPlanCourses SubscriptionPlanCourse[]
}

model UserCourse {
  id          Int            @id @default(autoincrement())
  userId      String
  courseId    Int
  purchasedAt DateTime       @default(now())
  status      PurchaseStatus @default(ACTIVE)
  course      Course         @relation("UserCourses", fields: [courseId], references: [id], onDelete: Cascade)
  user        User           @relation("UserCourses", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
}

model Term {
  id          Int          @id @unique @default(autoincrement())
  name        String
  createAt    DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  duration    Int          @default(0)
  subtitle    String?
  discount    Int?         @default(0)
  price       Int          @default(0)
  cartTerms   CartTerm[]   @relation("CartToTerms")
  courseTerms CourseTerm[] @relation("TermToCourses")
  sessions    Session[]    @relation("TermToSessions")
  userTerms   UserTerm[]   @relation("UserTerms")
  sessionTerms SessionTerm[] 
}

model CourseTerm {
  id         Int      @id @unique @default(autoincrement())
  courseId   Int
  termId     Int
  isOptional Boolean  @default(false)
  createAt   DateTime @default(now())
  updatedAt  DateTime @updatedAt
  course     Course   @relation("CourseToTerms", fields: [courseId], references: [id], onDelete: Cascade)
  term       Term     @relation("TermToCourses", fields: [termId], references: [id], onDelete: Cascade)

  @@unique([courseId, termId])
}

model Session {
  id              String            @id @unique @default(uuid())
  name            String
  termId          Int?
  isFree          Boolean           @default(false)
  createAt        DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  duration        Int
  videoId         Int?              @unique
  order           Int               @default(0)
  isActive        Boolean           @default(false)
  audioId         Int?              @unique
  type            SessionType       @default(VIDEO)
  questions       Question[]
  audio           SessionAudio?     @relation("SessionToAudio", fields: [audioId], references: [id])
  term            Term?              @relation("TermToSessions", fields: [termId], references: [id], onDelete: Cascade)
  video           SessionVideo?     @relation("SessionToVideo", fields: [videoId], references: [id])
  sessionProgress SessionProgress[] @relation("SessionProgress")
  sessionTerms    SessionTerm[] 
}

model SessionTerm {
  id        Int     @id @default(autoincrement())
  sessionId String
  termId    Int
  order     Int?

  session   Session @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  term      Term    @relation(fields: [termId], references: [id], onDelete: Cascade)

  @@unique([sessionId, termId])
}

model SessionVideo {
  id          Int              @id @unique @default(autoincrement())
  videoKey    String
  accessLevel VideoAccessLevel @default(REGISTERED)
  status      VideoStatus      @default(AVAILABLE)
  createAt    DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  session     Session?         @relation("SessionToVideo")
}

model SessionAudio {
  id          Int              @id @unique @default(autoincrement())
  audioKey    String
  accessLevel VideoAccessLevel @default(REGISTERED)
  status      VideoStatus      @default(AVAILABLE)
  createAt    DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  session     Session?         @relation("SessionToAudio")
}

model SessionProgress {
  id          Int      @id @default(autoincrement())
  userId      String
  sessionId   String
  isCompleted Boolean  @default(false)
  createAt    DateTime @default(now())
  updatedAt   DateTime @updatedAt
  session     Session  @relation("SessionProgress", fields: [sessionId], references: [id], onDelete: Cascade)
  user        User     @relation("SessionProgress", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, sessionId])
}

model Question {
  id           String    @id @default(uuid())
  userId       String
  courseId     Int
  sessionId    String
  questionText String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  answerText   String?
  answeredAt   DateTime?
  isAnswered   Boolean   @default(false)
  isReadByUser Boolean   @default(false)
  course       Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)
  session      Session   @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Instructor {
  id        Int      @id @unique @default(autoincrement())
  userId    String   @unique
  describe  String?
  bio       String?
  skills    String?
  createAt  DateTime @default(now())
  updatedAt DateTime @updatedAt
  courses   Course[]
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserTerm {
  id          Int      @id @default(autoincrement())
  userId      String
  termId      Int
  purchasedAt DateTime @default(now())
  term        Term     @relation("UserTerms", fields: [termId], references: [id], onDelete: Cascade)
  user        User     @relation("UserTerms", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, termId])
}

model Cart {
  id                 Int          @id @unique @default(autoincrement())
  userId             String
  status             CartStatus   @default(PENDING)
  totalPrice         Int?
  totalDiscount      Int?
  createAt           DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  discountCodeId     Int?
  discountCodeAmount Int?
  discountAppliedAt  DateTime?
  user               User         @relation("UserCarts", fields: [userId], references: [id], onDelete: Cascade)
  cartCourses        CartCourse[] @relation("CartToCourses")
  cartTerms          CartTerm[]   @relation("CartToCartTerms")
  payment            Payment?     @relation("CartToPayment")
  cartSubscriptions  CartSubscription[] @relation("CartToCartSubscriptions")
  discountCode DiscountCode? @relation("DiscountToCourseCarts", fields: [discountCodeId], references: [id], onDelete: SetNull)
}

model CartCourse {
  id       Int    @id @unique @default(autoincrement())
  cartId   Int
  courseId Int
  cart     Cart   @relation("CartToCourses", fields: [cartId], references: [id], onDelete: Cascade)
  course   Course @relation("CourseToCartCourses", fields: [courseId], references: [id], onDelete: Cascade)
}

model CartTerm {
  id        Int      @id @unique @default(autoincrement())
  cartId    Int
  termId    Int
  price     Int
  discount  Int?
  createAt  DateTime @default(now())
  updatedAt DateTime @updatedAt
  cart      Cart     @relation("CartToCartTerms", fields: [cartId], references: [id])
  term      Term     @relation("CartToTerms", fields: [termId], references: [id], onDelete: Cascade)

  @@unique([cartId, termId])
}

model Payment {
  id            Int           @id @unique @default(autoincrement())
  userId        String
  cartId        Int?          @unique
  amount        Int
  status        PaymentStatus
  method        PaymentMethod
  authority     String?       @unique
  createAt      DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  transactionId BigInt?
  cart          Cart?         @relation("CartToPayment", fields: [cartId], references: [id])
  user          User          @relation("UserToPayments", fields: [userId], references: [id], onDelete: Cascade)
  shopOrderId   Int?          @unique
  shopOrder     ShopOrder? @relation("ShopOrderToPayment", fields: [shopOrderId], references: [id], onDelete: Cascade)
  kind          PaymentKind   @default(DIGITAL)
}

model Comment {
  id        Int           @id @default(autoincrement())
  content   String
  userId    String
  courseId  Int?
  articleId Int?
  parentId  Int?
  createAt  DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  status    CommentStatus @default(PENDING)
  article   Article?      @relation(fields: [articleId], references: [id], onDelete: Cascade)
  course    Course?       @relation(fields: [courseId], references: [id], onDelete: Cascade)
  parent    Comment?      @relation("CommentReplies", fields: [parentId], references: [id])
  replies   Comment[]     @relation("CommentReplies")
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Article {
  id           Int       @id @default(autoincrement())
  title        String
  content      String
  createAt     DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  cover        String
  subtitle     String
  isActive     Boolean   @default(false)
  readTime     Int
  shortAddress String    @unique
  comments     Comment[]
}

model VerificationCode {
  id        Int      @id @default(autoincrement())
  phone     String   @unique
  expiresAt DateTime
  code      Int
}

model FAQ {
  id        Int         @id @default(autoincrement())
  question  String
  answer    String
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  category  CategoryFAQ @default(GENERAL)
}

model Newsletter {
  id        Int      @id @default(autoincrement())
  userId    String?
  createdAt DateTime @default(now())
  phone     String   @unique

  @@index([phone])
}

model Ticket {
  title         String
  description   String
  status        TicketStatus  @default(PENDING)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  userId        String
  courseId      Int?
  id            Int           @id @default(autoincrement())
  course        Course?       @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  ticketReplies TicketReply[]
}

model TicketReply {
  content   String
  createdAt DateTime      @default(now())
  userId    String
  id        Int           @id @default(autoincrement())
  ticketId  Int
  parentId  Int?
  parent    TicketReply?  @relation("ParentReply", fields: [parentId], references: [id])
  children  TicketReply[] @relation("ParentReply")
  ticket    Ticket        @relation(fields: [ticketId], references: [id])
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VisitLog {
  id        Int      @id @default(autoincrement())
  ipAddress String
  userAgent String
  pageUrl   String
  referrer  String?
  visitedAt DateTime @default(now())
}

model SiteInfo {
  id               Int      @id @default(autoincrement())
  shortDescription String
  fullDescription  String
  companyAddress   String?
  companyEmail     String
  socialLinks      Json?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  articlesLinks    Json?
  coursesLinks     Json?
  usefulLinks      Json?
  companyPhone     String?
  heroImage        String?
  rules            String?

  // üî• ÿ¨ÿØ€åÿØ
  shopVisibility   ShopVisibility @default(ALL)

  shopLeadTimeDays Int      @default(1)

  postFallbackBaseCost       Int?
  postFallbackCostPerKg      Int?
}

model SeoSetting {
  id        Int      @id @default(autoincrement())
  page      String
  key       String
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([page, key])
}

model SitemapSetting {
  id           Int      @id @default(autoincrement())
  section      String   @unique
  changefreq   String
  priority     Float
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  shortAddress String?
}

model DiscountCode {
  id                Int            @id @default(autoincrement())
  title             String
  code              String         @unique
  discountPercent   Float
  maxDiscountAmount Float?
  usageLimit        Int?
  usageCount        Int            @default(0)
  appliesTo         DiscountScope  @default(ALL)
  minPurchaseAmount Float?
  expiryDate        DateTime?
  description       String?
  courseId          Int?
  productCategoryId Int?
  isActive          Boolean        @default(true)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  course            Course?        @relation(fields: [courseId], references: [id], onDelete: Cascade)
  userDiscount      UserDiscount[]
  productCategory   ProductCategory? @relation(fields: [productCategoryId], references: [id])
  shopCarts         ShopCart[]     @relation("DiscountToShopCarts")
  carts             Cart[]         @relation("DiscountToCourseCarts")
}

model UserDiscount {
  id             Int          @id @default(autoincrement())
  userId         String
  discountCodeId Int
  usedAt         DateTime     @default(now())
  discountCode   DiscountCode @relation(fields: [discountCodeId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, discountCodeId])
}

model Podcast {
  id              String           @id @default(uuid())
  title           String           @db.VarChar(255)
  description     String
  logoUrl         String
  bannerUrl       String
  hostName        String
  language        String
  genre           String
  websiteUrl      String?
  rssFeed         String?
  email           String?
  explicit        Boolean          @default(false)
  spotifyUrl      String?
  appleUrl        String?
  googleUrl       String?
  castboxUrl      String?
  otherLinks      Json?
  metaTitle       String?
  metaDescription String?
  keywords        String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  slug            String           @unique
  episodes        PodcastEpisode[]
}

model PodcastEpisode {
  id              String   @id @default(uuid())
  podcastId       String
  title           String
  slug            String   @unique
  description     String
  audioUrl        String
  duration        Int
  publishedAt     DateTime
  playCount       Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  coverImageUrl   String?
  episodeNumber   Int?
  explicit        Boolean  @default(false)
  isDraft         Boolean  @default(false)
  keywords        String?
  metaDescription String?
  metaTitle       String?
  seasonNumber    Int?
  podcast         Podcast  @relation(fields: [podcastId], references: [id])
}

model SupportSession {
  id          String           @id @default(cuid())
  userId      String?
  anonymousId String?
  createdAt   DateTime         @default(now())
  messages    SupportMessage[]
  user        User?            @relation(fields: [userId], references: [id])
}

model SupportMessage {
  id          Int              @id @default(autoincrement())
  sender      Sender           @default(USER)
  content     String
  userId      String?
  createdAt   DateTime         @default(now())
  anonymousId String?
  isSeen      Boolean          @default(false)
  replyToId   Int?
  sessionId   String?
  replyTo     SupportMessage?  @relation("ReplyRelation", fields: [replyToId], references: [id])
  replies     SupportMessage[] @relation("ReplyRelation")
  session     SupportSession?  @relation(fields: [sessionId], references: [id])
  user        User?            @relation(fields: [userId], references: [id])
}

model SubscriptionPlan {
  id                Int                       @id @default(autoincrement())
  name              String
  description       String?
  features          Json?
  price             Int
  discountAmount    Int?                     @default(0)
  durationInDays    Int
  intervalLabel     String
  isActive          Boolean                   @default(true)
  createdAt         DateTime                  @default(now())
  updatedAt         DateTime                  @updatedAt
  planCourses       SubscriptionPlanCourse[]
  userSubscriptions UserSubscription[]
  cartSubscriptions CartSubscription[]
}

model SubscriptionPlanCourse {
  id       Int              @id @default(autoincrement())
  planId   Int
  courseId Int

  plan     SubscriptionPlan @relation(fields: [planId], references: [id], onDelete: Cascade)
  course   Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([planId, courseId])
}

model UserSubscription {
  id        Int                 @id @default(autoincrement())
  userId    String
  planId    Int
  status    SubscriptionStatus  @default(ACTIVE)
  startDate DateTime            @default(now())
  endDate   DateTime            // ÿ™ÿßÿ±€åÿÆ Ÿæÿß€åÿßŸÜ ÿßÿ¥ÿ™ÿ±ÿß⁄©
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt
  meta      Json?
  user      User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  plan      SubscriptionPlan    @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([planId])
}

model CartSubscription {
  id                 Int              @id @default(autoincrement())
  cartId             Int
  subscriptionPlanId Int
  price              Int              // ŸÇ€åŸÖÿ™ ŸÜŸáÿß€å€å (ÿ®ÿπÿØ ÿßÿ≤ ÿßÿπŸÖÿßŸÑ ÿ™ÿÆŸÅ€åŸÅ‚ÄåŸáÿß)
  discount           Int?             // ŸÖÿ®ŸÑÿ∫ €åÿß ÿØÿ±ÿµÿØ ÿ™ÿÆŸÅ€åŸÅÿå ÿ®ÿ≥ÿ™Ÿá ÿ®Ÿá ŸÖŸÜÿ∑ŸÇ ÿÆŸàÿØÿ™
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt

  cart               Cart             @relation("CartToCartSubscriptions", fields: [cartId], references: [id], onDelete: Cascade)
  subscriptionPlan   SubscriptionPlan @relation(fields: [subscriptionPlanId], references: [id], onDelete: Cascade)

  @@unique([cartId, subscriptionPlanId])
}

model ProductCategory {
  id        Int       @id @default(autoincrement())
  title     String
  slug      String    @unique
  parentId  Int?
  parent    ProductCategory? @relation("CategoryParent", fields: [parentId], references: [id], onDelete: SetNull)
  children  ProductCategory[] @relation("CategoryParent")

  products  Product[]
  discountCodes    DiscountCode[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([parentId])
}

model Product {
  id          Int      @id @default(autoincrement())
  title       String
  slug        String   @unique
  urlSlug     String      
  description String?

  coverImage  String?      // ⁄©ÿßŸàÿ± ŸÖÿ≠ÿµŸàŸÑ
  images      String[]     @default([]) 
    
  isActive    Boolean  @default(true)

  // ŸÇ€åŸÖÿ™‚ÄåŸáÿß (ÿ™ŸàŸÖÿßŸÜ/ÿ±€åÿßŸÑ ÿ±ÿß ŸÖÿ´ŸÑ ÿ≥€åÿ≥ÿ™ŸÖ ŸÅÿπŸÑ€å ÿ®ÿß Int ŸÜ⁄ØŸá ÿØÿßÿ±)
  price       Int
  compareAt   Int?     // ŸÇ€åŸÖÿ™ ŸÇÿ®ŸÑ ÿ™ÿÆŸÅ€åŸÅ (ÿßÿÆÿ™€åÿßÿ±€å)

  // ÿßŸÜÿ®ÿßÿ±
  stock       Int      @default(0)

  // ÿßÿ±ÿ≥ÿßŸÑ (ÿßÿÆÿ™€åÿßÿ±€å ŸàŸÑ€å ŸÖŸÅ€åÿØ)
  weightGram  Int?     // Ÿàÿ≤ŸÜ ÿ®ÿ±ÿß€å ŸÖÿ≠ÿßÿ≥ÿ®Ÿá ÿßÿ±ÿ≥ÿßŸÑ
  details     Json?
  categoryId  Int?
  category    ProductCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  packageBoxTypeId Int?
  packageBoxType   PostexBoxCache? @relation("ProductToPostexBox", fields: [packageBoxTypeId], references: [id])

  cartItems   ShopCartItem[]
  orderItems  ShopOrderItem[]
  colors      ProductColor[]
  sizes       ProductSize[] 

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive])
  @@index([categoryId])
}

model ShopCart {
  id        Int          @id @default(autoincrement())
  userId    String
  status    ShopCartStatus @default(PENDING)
  isActive  Boolean        @default(true)

  discountCodeId     Int?
  discountCodeAmount Int?
  discountAppliedAt  DateTime?

  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  orders    ShopOrder[]

  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     ShopCartItem[]
  discountCode DiscountCode? @relation("DiscountToShopCarts", fields: [discountCodeId], references: [id], onDelete: SetNull)


  @@index([userId])
  @@index([userId, isActive])
  @@index([discountCodeId])
}

model ShopCartItem {
  id        Int  @id @default(autoincrement())
  cartId    Int
  productId Int
  qty       Int  @default(1)
  unitPrice Int
  colorId   Int?
  sizeId    Int?

  color     Color? @relation(fields: [colorId], references: [id], onDelete: SetNull)
  size      Size?  @relation(fields: [sizeId], references: [id], onDelete: SetNull)

  cart      ShopCart @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  // color/size relations...

  @@unique([cartId, productId, colorId, sizeId])
  @@index([productId])
}

model ShopOrder {
  id               Int              @id @default(autoincrement())
  userId           String

  shopCartId       Int?             @unique
  postOptionKey    String?
  shippingMeta     Json?

  status           ShopOrderStatus  @default(PENDING_PAYMENT)
  paymentStatus    PaymentStatus    @default(PENDING)

  fullName         String
  phone            String
  province         String
  city             String
  address1         String
  postalCode       String?
  notes            String?

  subtotal         Int              @default(0)
  discountAmount   Int              @default(0)
  payableOnline    Int              @default(0)
  payableCOD       Int              @default(0)

  shippingCost     Int              @default(0)
  shippingMethod   ShippingMethod   @default(POST)
  trackingCode     String?
  deliveryDate     DateTime?
  deliverySlot     String?
  shippingTitle    String           @default("")

  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  user             User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  items            ShopOrderItem[]
  payment          Payment?         @relation("ShopOrderToPayment")

  shopCart         ShopCart?        @relation(fields: [shopCartId], references: [id], onDelete: SetNull)
  returnRequests   ShopReturnRequest[]

  @@index([userId])
  @@index([status])
}


model ShopOrderItem {
  id         Int      @id @default(autoincrement())
  orderId    Int
  productId  Int
  qty        Int

  // snapshot
  title      String
  unitPrice  Int
  colorId    Int?
  sizeId     Int?
  coverImage String?   // ÿßÿÆÿ™€åÿßÿ±€å ŸàŸÑ€å ÿ®ÿ±ÿß€å ŸÜŸÖÿß€åÿ¥ ŸÅÿß⁄©ÿ™Ÿàÿ± ÿπÿßŸÑ€åŸá
  slug       String?   // ÿßÿÆÿ™€åÿßÿ±€å

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  order      ShopOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product    Product   @relation(fields: [productId], references: [id], onDelete: Restrict)

  color   Color? @relation(fields: [colorId], references: [id], onDelete: SetNull)
  size    Size?  @relation(fields: [sizeId], references: [id], onDelete: SetNull)
  returnRequest ShopReturnRequest?

  @@index([productId])
  @@index([orderId])
}

model UserAddress {
  id          Int      @id @default(autoincrement())
  userId      String
  fullName    String
  phone       String
  province    String
  city        String
  address1    String
  postalCode  String?
  notes       String?
  isDefault   Boolean  @default(false)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Color {
  id        Int      @id @default(autoincrement())
  name      String
  hex       String   // ŸÖÿ´ŸÑ #ffffff
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  products  ProductColor[]
  shopCartItems ShopCartItem[]
  shopOrderItems ShopOrderItem[]

  @@unique([name])
  @@index([isActive])
}

model ProductColor {
  productId Int
  colorId   Int

  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  color     Color   @relation(fields: [colorId], references: [id], onDelete: Cascade)

  @@id([productId, colorId])
  @@index([colorId])
}

model Size {
  id        Int      @id @default(autoincrement())
  name      String
  slug      String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  shopCartItems ShopCartItem[]
  shopOrderItems ShopOrderItem[]
  products  ProductSize[]

  @@unique([name])
  @@index([isActive])
}
model ProductSize {
  productId Int
  sizeId    Int

  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  size      Size    @relation(fields: [sizeId], references: [id], onDelete: Cascade)

  @@id([productId, sizeId])
  @@index([sizeId])
}

model PostexBoxCache {
  id          Int    @id // ŸáŸÖŸàŸÜ box id Ÿæÿ≥ÿ™⁄©ÿ≥
  name        String
  height      Int
  width       Int
  length      Int
  products    Product[] @relation("ProductToPostexBox")
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())
}

model ShopReturnRequest {
  id          Int                 @id @default(autoincrement())
  userId      String
  orderId     Int
  orderItemId Int                 @unique 

  qty         Int                 @default(1)
  reason      ReturnReason
  description String?

  adminNote   String?

  status      ReturnRequestStatus @default(PENDING)

  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt

  user        User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  order       ShopOrder           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderItem   ShopOrderItem       @relation(fields: [orderItemId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([orderId])
  @@unique([orderId, orderItemId]) // ‚úÖ ÿ®ÿ±ÿß€å Ÿáÿ± ÿ¢€åÿ™ŸÖ €å⁄© ÿØÿ±ÿÆŸàÿßÿ≥ÿ™
}

enum ShopVisibility {
  OFF
  ADMIN_ONLY
  ALL
}

enum ReturnRequestStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
}

enum ReturnReason {
  DAMAGED
  WRONG_ITEM
  SIZE_ISSUE
  COLOR_ISSUE
  NOT_AS_DESCRIBED
  OTHER
}

enum ShopOrderStatus {
  PENDING_PAYMENT
  PROCESSING
  PACKED
  SHIPPED
  DELIVERED
  CANCELLED
  RETURNED
}

enum ShopCartStatus {
  PENDING
  CHECKED_OUT
  ABANDONED
}

enum PaymentKind {
  DIGITAL
  SHOP
  BOTH
}

enum ShippingMethod {
  POST
  COURIER_COD
}

enum Sender {
  USER
  SUPPORT
}

enum Role {
  USER
  ADMIN
  MANAGER
}

enum SessionType {
  VIDEO
  AUDIO
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  BEGINNER_INTERMEDIATE
  INTERMEDIATE_ADVANCED
  BEGINNER_ADVANCED
}

enum CourseStatus {
  COMPLETED
  IN_PROGRESS
}

enum PurchaseStatus {
  ACTIVE
  CANCELLED
  EXPIRED
}

enum PaymentStatus {
  PENDING
  SUCCESSFUL
  FAILED
}

enum PaymentMethod {
  CREDIT_CARD
  ONLINE
  FREE
}

enum CartStatus {
  PENDING
  PAID
  CANCELLED
  COMPLETED
}

enum CommentStatus {
  PENDING
  APPROVED
  REJECTED
}

enum TicketStatus {
  PENDING
  IN_PROGRESS
  CLOSED
  ANSWERED
  OPEN
}

enum CategoryFAQ {
  COURSE
  ONLINE_CLASS
  GENERAL
}

enum VideoAccessLevel {
  PUBLIC
  REGISTERED
  PURCHASED
}

enum VideoStatus {
  AVAILABLE
  UNAVAILABLE
}

enum SubscriptionStatus {
  ACTIVE
  EXPIRED
  CANCELED
}

enum CoursePricingMode {
  TERM_ONLY
  SUBSCRIPTION_ONLY
  BOTH
}

enum DiscountScope {
  ALL
  COURSE
  PRODUCT
  PRODUCT_CATEGORY
}